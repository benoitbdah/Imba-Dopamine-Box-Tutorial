{"id":"dj","warnings":[],"errors":[],"js":"function iter$__(a){ let v; return a ? ((v=a.toIterable) ? v.call(a) : a) : a; };;\n// @ts-ignore\nfunction isa$(a,b){ return typeof b === \"string\" ? (typeof a === b) : b[Symbol.hasInstance]?.(a) }\nimport {register$} from 'imba/runtime';\n\n/*body*/\n// imba$stdlib=1\n\nfunction injectStringBefore(target,toInject,patterns = ['']){\n\tfor (let $1 = 0, $2 = iter$__(patterns), $3 = $2.length; $1 < $3; $1++) {\n\t\tlet patt = $2[$1];\n\t\tlet idx = target.indexOf(patt);\n\t\tif (idx >= 0) {\n\t\t\treturn target.slice(0,idx) + toInject + target.slice(idx);\n\t\t};\n\t};\n\treturn target;\n};\n\nimport fs from 'fs';\n\nlet c$0 = Symbol();\nclass ImbaAsset {\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n\t\n\tget entry(){\n\t\treturn globalThis.IMBA_MANIFEST?.[this.src];\n\t}\n\t\n\tget url(){\n\t\treturn this.entry ? this.entry.url : this.src;\n\t}\n\t\n\tget path(){\n\t\treturn this.entry ? this.entry.path : null;\n\t}\n\t\n\tget body(){\n\t\tif (false) {};\n\t\treturn null;\n\t}\n\t\n\ttoString(){\n\t\treturn this.url;\n\t}\n\tstatic { register$(this,c$0,'ImbaAsset',16) }\n};\n\nexport function asset(src){\n\tlet asset;\n\tif (asset = globalThis.IMBA_MANIFEST?.[src]) {\n\t\treturn new ImbaAsset(src);\n\t\t// return asset.url or asset\n\t};\n\treturn src;\n};\n\nlet c$1 = Symbol();\nclass HtmlAsset {\n\tconstructor(text,refs){\n\t\tthis.text = text;\n\t\tthis.refs = refs;\n\t}\n\t\n\tget body(){\n\t\tvar self = this;\n\t\tlet res = this.text.replace(/ASSET_REF_(\\d+)/g,function(m,nr) {\n\t\t\tlet asset;\n\t\t\tlet ref = self.refs[nr];\n\t\t\tif (isa$(ref,ImbaAsset)) {\n\t\t\t\treturn String(ref);\n\t\t\t};\n\t\t\tif (asset = globalThis.IMBA_MANIFEST?.[String(ref)]) {\n\t\t\t\treturn asset.url;\n\t\t\t};\n\t\t\treturn ref;\n\t\t});\n\t\t\n\t\tif (globalThis.IMBA_HMR_PATH) {\n\t\t\tres = injectStringBefore(res,\"<script src='/__hmr__.js'></script>\",['<!--$head$-->','<!--$body$-->','<html','']);\n\t\t};\n\t\treturn res;\n\t}\n\t\n\ttoString(){\n\t\treturn this.body;\n\t}\n\tstatic { register$(this,c$1,'HtmlAsset',16) }\n};\n\nexport function html(text,refs){\n\treturn new HtmlAsset(text,refs);\n};\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXRzLmltYmEiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhc3NldHMuaW1iYSJdLCJzb3VyY2VzQ29udGVudCI6WyIjIGltYmEkc3RkbGliPTFcblxuZGVmIGluamVjdFN0cmluZ0JlZm9yZSB0YXJnZXQsIHRvSW5qZWN0LCBwYXR0ZXJucyA9IFsnJ11cblx0Zm9yIHBhdHQgaW4gcGF0dGVybnNcblx0XHRsZXQgaWR4ID0gdGFyZ2V0LmluZGV4T2YocGF0dClcblx0XHRpZiBpZHggPj0gMFxuXHRcdFx0cmV0dXJuIHRhcmdldC5zbGljZSgwLGlkeCkgKyB0b0luamVjdCArIHRhcmdldC5zbGljZShpZHgpXG5cdHJldHVybiB0YXJnZXRcblxuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuXG5jbGFzcyBJbWJhQXNzZXRcblx0ZGVmIGNvbnN0cnVjdG9yIHNyY1xuXHRcdHNyYyA9IHNyY1xuXG5cdGdldCBlbnRyeVxuXHRcdGdsb2JhbC5JTUJBX01BTklGRVNULi5bc3JjXVxuXG5cdGdldCB1cmxcblx0XHRlbnRyeSA/IGVudHJ5LnVybCA6IHNyY1xuXG5cdGdldCBwYXRoXG5cdFx0ZW50cnkgPyBlbnRyeS5wYXRoIDogbnVsbFxuXG5cdGdldCBib2R5XG5cdFx0aWYgJG5vZGUkXG5cdFx0XHRpZiBwYXRoXG5cdFx0XHRcdHJldHVybiBmcy5yZWFkRmlsZVN5bmMocGF0aCwndXRmLTgnKVxuXHRcdHJldHVybiBudWxsXG5cblx0ZGVmIHRvU3RyaW5nXG5cdFx0dXJsXG5cbmV4cG9ydCBkZWYgYXNzZXQgc3JjXG5cdGlmIGxldCBhc3NldCA9IGdsb2JhbC5JTUJBX01BTklGRVNULi5bc3JjXVxuXHRcdHJldHVybiBuZXcgSW1iYUFzc2V0KHNyYylcblx0XHQjIHJldHVybiBhc3NldC51cmwgb3IgYXNzZXRcblx0cmV0dXJuIHNyY1xuXG5jbGFzcyBIdG1sQXNzZXRcblx0ZGVmIGNvbnN0cnVjdG9yIHRleHQscmVmc1xuXHRcdHRleHQgPSB0ZXh0XG5cdFx0cmVmcyA9IHJlZnNcblxuXHRnZXQgYm9keVxuXHRcdGxldCByZXMgPSB0ZXh0LnJlcGxhY2UoL0FTU0VUX1JFRl8oXFxkKykvZykgZG8obSxucilcblx0XHRcdGxldCByZWYgPSByZWZzW25yXVxuXHRcdFx0aWYgcmVmIGlzYSBJbWJhQXNzZXRcblx0XHRcdFx0cmV0dXJuIFN0cmluZyhyZWYpXG5cdFx0XHRpZiBsZXQgYXNzZXQgPSBnbG9iYWwuSU1CQV9NQU5JRkVTVC4uW1N0cmluZyhyZWYpXVxuXHRcdFx0XHRyZXR1cm4gYXNzZXQudXJsXG5cdFx0XHRyZXR1cm4gcmVmXG5cblx0XHRpZiBnbG9iYWwuSU1CQV9ITVJfUEFUSFxuXHRcdFx0cmVzID0gaW5qZWN0U3RyaW5nQmVmb3JlKHJlcyxcIjxzY3JpcHQgc3JjPScvX19obXJfXy5qcyc+PC9zY3JpcHQ+XCIsWyc8IS0tJGhlYWQkLS0+JywnPCEtLSRib2R5JC0tPicsJzxodG1sJywnJ10pXG5cdFx0cmV0dXJuIHJlc1xuXG5cdGRlZiB0b1N0cmluZ1xuXHRcdGJvZHlcblxuZXhwb3J0IGRlZiBodG1sIHRleHQsIHJlZnNcblx0cmV0dXJuIG5ldyBIdG1sQXNzZXQodGV4dCxyZWZzKSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUVBLFFBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUUsUUFBUSxDQUFFLFFBQVEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0NBQ3ZELEdBQUcsMkJBQVMsUUFBUSxrQ0FBQTtNQUFoQixJQUFJO0VBQ0gsSUFBQSxHQUFHLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7RUFDOUIsRUFBRSxFQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFBO0dBQ1YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0dBQUE7RUFB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","css":""}