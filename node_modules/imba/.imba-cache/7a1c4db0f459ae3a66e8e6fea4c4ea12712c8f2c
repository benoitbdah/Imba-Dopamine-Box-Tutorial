{"id":"cn","warnings":[],"errors":[],"js":"// @ts-ignore\nfunction isa$(a,b){ return typeof b === \"string\" ? (typeof a === b) : b[Symbol.hasInstance]?.(a) }\nconst $insertInto$ = Symbol.for('#insertInto'), $removeFrom$ = Symbol.for('#removeFrom');\n\n/*body*/\n// imba$stdlib=1\nimport {renderContext,RenderContext} from './context';\nimport {scheduler} from '../scheduler';\nimport {Component} from './component';\n\nimport {emit,listen,once} from '../utils';\n\nexport function render(blk,ctx = {}){\n\tlet prev = renderContext.context;\n\trenderContext.context = ctx;\n\tlet res = blk(ctx);\n\tif (renderContext.context == ctx) {\n\t\trenderContext.context = prev;\n\t};\n\treturn res;\n};\n\nexport function mount(mountable,into,o = {}){\n\tif (false) {};\n\t\n\tlet parent = into || globalThis.document.body;\n\tlet element = mountable;\n\tif (isa$(mountable,Function)) {\n\t\tlet fn = mountable;\n\t\t// Allow getting hold of that render context?\n\t\t\n\t\tlet tick = o.tick ||= function() {\n\t\t\tlet ctx = o.context ||= new RenderContext(parent,null);\n\t\t\tlet prev = renderContext.context;\n\t\t\trenderContext.context = ctx;\n\t\t\t\n\t\t\tlet res = mountable(ctx,o);\n\t\t\t\n\t\t\tif (renderContext.context == ctx) {\n\t\t\t\trenderContext.context = prev;\n\t\t\t};\n\t\t\t\n\t\t\tif (o.node != res) {\n\t\t\t\tif (o.node) {\n\t\t\t\t\tglobalThis.imba.unmount(o.node);\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (res) {\n\t\t\t\t\t(o.node = res)[$insertInto$](parent);\n\t\t\t\t\tif (res.tick == Component.prototype.tick) {\n\t\t\t\t\t\t// Highly experimental\n\t\t\t\t\t\tres.tick = o.tick;\n\t\t\t\t\t\tif (res.scheduledÎ¦) {  };\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// if easing - this is not enough\n\t\t\t\t\tonce(res,'unmount',function() {\n\t\t\t\t\t\tif (o.node == res) {\n\t\t\t\t\t\t\to.node = null;\n\t\t\t\t\t\t\t// what if it is remounted?\n\t\t\t\t\t\t\treturn scheduler.unlisten('commit',o.tick);\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\to.node = res;\n\t\t\t\t\tscheduler.unlisten('commit',o.tick);\n\t\t\t\t};\n\t\t\t};\n\t\t\t\n\t\t\treturn res;\n\t\t};\n\t\t\n\t\t// element = tick()\n\t\tscheduler.listen('commit',tick);\n\t\treturn tick();\n\t} else {\n\t\t// automatic scheduling of element\n\t\telement.__F |= 64;\n\t};\n\t\n\telement[$insertInto$](parent);\n\treturn element;\n};\n\nexport function unmount(el){\n\tif (el && el[$removeFrom$] && el.parentNode) {\n\t\tel[$removeFrom$](el.parentNode);\n\t};\n\treturn el;\n};\n\nlet instance = globalThis.imba ||= {};\ninstance.mount = mount;\ninstance.unmount = unmount;\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW91bnQuaW1iYSIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vdW50LmltYmEiXSwic291cmNlc0NvbnRlbnQiOlsiIyBpbWJhJHN0ZGxpYj0xXG5pbXBvcnQge3JlbmRlckNvbnRleHQsUmVuZGVyQ29udGV4dH0gZnJvbSAnLi9jb250ZXh0J1xuaW1wb3J0IHtzY2hlZHVsZXJ9IGZyb20gJy4uL3NjaGVkdWxlcidcbmltcG9ydCB7Q29tcG9uZW50fSBmcm9tICcuL2NvbXBvbmVudCdcblxuaW1wb3J0IHtlbWl0LGxpc3RlbixvbmNlfSBmcm9tICcuLi91dGlscydcblxuZXhwb3J0IGRlZiByZW5kZXIgYmxrLCBjdHggPSB7fVxuXHRsZXQgcHJldiA9IHJlbmRlckNvbnRleHQuY29udGV4dFxuXHRyZW5kZXJDb250ZXh0LmNvbnRleHQgPSBjdHhcblx0bGV0IHJlcyA9IGJsayhjdHgpXG5cdGlmIHJlbmRlckNvbnRleHQuY29udGV4dCA9PSBjdHhcblx0XHRyZW5kZXJDb250ZXh0LmNvbnRleHQgPSBwcmV2XG5cdHJldHVybiByZXNcblxuZXhwb3J0IGRlZiBtb3VudCBtb3VudGFibGUsIGludG9cXEVsZW1lbnQ/LCBvID0ge31cblx0aWYgJG5vZGUkXG5cdFx0Y29uc29sZS5lcnJvciBcImltYmEubW91bnQgbm90IHN1cHBvcnRlZCBvbiBzZXJ2ZXIuXFxuVG8gc3Bhd24gYSBkZXYtc2VydmVyIGZvciBhbiBpbWJhIGNsaWVudCBydW46XFxuICA+IGltYmEgc2VydmUgbXktaW1iYS1maWxlLmltYmFcIlxuXHRcdCMgaWYgbW91bnRhYmxlIGlzYSBGdW5jdGlvblxuXHRcdHJldHVybiBTdHJpbmcobW91bnRhYmxlKVxuXG5cdGxldCBwYXJlbnQgPSBpbnRvIG9yIGdsb2JhbC5kb2N1bWVudC5ib2R5XG5cdGxldCBlbGVtZW50ID0gbW91bnRhYmxlXG5cdGlmIG1vdW50YWJsZSBpc2EgRnVuY3Rpb25cblx0XHRsZXQgZm4gPSBtb3VudGFibGVcblx0XHQjIEFsbG93IGdldHRpbmcgaG9sZCBvZiB0aGF0IHJlbmRlciBjb250ZXh0P1xuXHRcblx0XHRsZXQgdGljayA9IG8udGljayB8fD0gZG9cblx0XHRcdGxldCBjdHggPSBvLmNvbnRleHQgfHw9IG5ldyBSZW5kZXJDb250ZXh0KHBhcmVudCxudWxsKVxuXHRcdFx0bGV0IHByZXYgPSByZW5kZXJDb250ZXh0LmNvbnRleHRcblx0XHRcdHJlbmRlckNvbnRleHQuY29udGV4dCA9IGN0eFxuXG5cdFx0XHRsZXQgcmVzID0gbW91bnRhYmxlKGN0eCxvKVxuXG5cdFx0XHRpZiByZW5kZXJDb250ZXh0LmNvbnRleHQgPT0gY3R4XG5cdFx0XHRcdHJlbmRlckNvbnRleHQuY29udGV4dCA9IHByZXZcblx0XHRcdFxuXHRcdFx0aWYgby5ub2RlICE9IHJlc1xuXHRcdFx0XHRpZiBvLm5vZGVcblx0XHRcdFx0XHRnbG9iYWwuaW1iYS51bm1vdW50KG8ubm9kZSlcblxuXHRcdFx0XHRpZiByZXNcblx0XHRcdFx0XHQoby5ub2RlID0gcmVzKS4jaW5zZXJ0SW50byhwYXJlbnQpXG5cdFx0XHRcdFx0aWYgcmVzLnRpY2sgPT0gQ29tcG9uZW50LnByb3RvdHlwZS50aWNrXG5cdFx0XHRcdFx0XHQjIEhpZ2hseSBleHBlcmltZW50YWxcblx0XHRcdFx0XHRcdHJlcy50aWNrID0gby50aWNrXG5cdFx0XHRcdFx0XHRpZiByZXMuc2NoZWR1bGVkP1xuXG5cdFx0XHRcdFx0IyBpZiBlYXNpbmcgLSB0aGlzIGlzIG5vdCBlbm91Z2hcblx0XHRcdFx0XHRvbmNlKHJlcywndW5tb3VudCcpIGRvXG5cdFx0XHRcdFx0XHRpZiBvLm5vZGUgPT0gcmVzXG5cdFx0XHRcdFx0XHRcdG8ubm9kZSA9IG51bGxcblx0XHRcdFx0XHRcdFx0IyB3aGF0IGlmIGl0IGlzIHJlbW91bnRlZD9cblx0XHRcdFx0XHRcdFx0c2NoZWR1bGVyLnVubGlzdGVuKCdjb21taXQnLG8udGljaylcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdG8ubm9kZSA9IHJlc1xuXHRcdFx0XHRcdHNjaGVkdWxlci51bmxpc3RlbignY29tbWl0JyxvLnRpY2spXG5cblx0XHRcdHJldHVybiByZXNcblxuXHRcdCMgZWxlbWVudCA9IHRpY2soKVxuXHRcdHNjaGVkdWxlci5saXN0ZW4oJ2NvbW1pdCcsdGljaylcblx0XHRyZXR1cm4gdGljaygpXG5cdGVsc2Vcblx0XHQjIGF1dG9tYXRpYyBzY2hlZHVsaW5nIG9mIGVsZW1lbnRcblx0XHRlbGVtZW50Ll9fRiB8PSAkRUxfU0NIRURVTEUkXG5cblx0ZWxlbWVudC4jaW5zZXJ0SW50byhwYXJlbnQpXG5cdHJldHVybiBlbGVtZW50XG5cbmV4cG9ydCBkZWYgdW5tb3VudCBlbFxuXHRpZiBlbCBhbmQgZWwuI3JlbW92ZUZyb20gYW5kIGVsLnBhcmVudE5vZGVcblx0XHRlbC4jcmVtb3ZlRnJvbShlbC5wYXJlbnROb2RlKVxuXHRyZXR1cm4gZWxcblxubGV0IGluc3RhbmNlID0gZ2xvYmFsLmltYmEgfHw9IHt9XG5pbnN0YW5jZS5tb3VudCA9IG1vdW50XG5pbnN0YW5jZS51bm1vdW50ID0gdW5tb3VudCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxNQUFNLEVBQUUsYUFBYSxDQUFDLGFBQWEsT0FBTyxXQUFXO0FBQ3JELE1BQU0sRUFBRSxTQUFTLE9BQU8sY0FBYztBQUN0QyxNQUFNLEVBQUUsU0FBUyxPQUFPLGFBQWE7O0FBRXJDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksT0FBTyxVQUFVOztBQUV6QyxNQUFNLENBQUMsUUFBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUUsR0FBRyxHQUFHLEVBQUUsQ0FBQTtDQUMxQixJQUFBLElBQUksR0FBRyxhQUFhLENBQUMsT0FBTztDQUNoQyxhQUFhLENBQUMsT0FBTyxHQUFHLEdBQUc7Q0FDdkIsSUFBQSxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQztDQUNsQixFQUFFLEVBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFBO0VBQzlCLGFBQWEsQ0FBQyxPQUFPLEdBQUcsSUFBSTtFQUFBO0NBQzdCLE1BQU0sQ0FBQyxHQUFHO0NBQUE7O0FBRVgsTUFBTSxDQUFDLFFBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFFLElBQUksQ0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFBO0NBQ2hELEVBQUUsRUFBQyxLQUFNOztDQUtMLElBQUEsTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJO0NBQ3JDLElBQUEsT0FBTyxHQUFHLFNBQVM7Q0FDdkIsRUFBRSxFQUFDLEtBQUEsU0FBUyxDQUFLLFFBQVEsQ0FBQSxFQUFBO0VBQ3BCLElBQUEsRUFBRSxHQUFHLFNBQVM7OztFQUdkLElBQUEsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssUUFBRSxHQUFBO0dBQ25CLElBQUEsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLEtBQUssR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0dBQ2xELElBQUEsSUFBSSxHQUFHLGFBQWEsQ0FBQyxPQUFPO0dBQ2hDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsR0FBRzs7R0FFdkIsSUFBQSxHQUFHLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7O0dBRTFCLEVBQUUsRUFBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUE7SUFDOUIsYUFBYSxDQUFDLE9BQU8sR0FBRyxJQUFJO0lBQUE7O0dBRTdCLEVBQUUsRUFBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUE7SUFDZixFQUFFLEVBQUMsQ0FBQyxDQUFDLElBQUksRUFBQTtLQUNSLFVBQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7S0FBQTs7SUFFNUIsRUFBRSxFQUFDLEdBQUcsRUFBQTtLQUNKLENBQUEsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsY0FBWSxDQUFDLE1BQU0sQ0FBQztLQUNsQyxFQUFFLEVBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUE7O01BRXRDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUk7TUFDakIsRUFBRSxFQUFDLEdBQUcsQ0FBQyxVQUFVO01BQUE7OztLQUdsQixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBRSxRQUFFLEdBQUE7TUFDckIsRUFBRSxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBQTtPQUNmLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSTs7T0FFYixPQUFBLFNBQVMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7T0FBQTtNQUFBLENBSmxCO0tBSWtCLE1BQ2xDO0tBQ0gsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHO0tBQ1osU0FBUyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztLQUFBO0lBQUE7O0dBRXJDLE1BQU0sQ0FBQyxHQUFHO0dBQUE7OztFQUdYLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztFQUMvQixNQUFNLENBQUMsSUFBSSxFQUFFO0VBQUEsTUFDVjs7RUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFhO0VBQUE7O0NBRTdCLE9BQU8sY0FBWSxDQUFDLE1BQU0sQ0FBQztDQUMzQixNQUFNLENBQUMsT0FBTztDQUFBOztBQUVmLE1BQU0sQ0FBQyxRQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQTtDQUNwQixFQUFFLEVBQUMsRUFBRSxDQUFDLEVBQUcsQ0FBQyxFQUFFLGNBQVksQ0FBQyxFQUFHLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBQTtFQUN6QyxFQUFFLGNBQVksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDO0VBQUE7Q0FDOUIsTUFBTSxDQUFDLEVBQUU7Q0FBQTs7QUFFTixJQUFBLFFBQVEsR0FBRyxVQUFNLENBQUMsSUFBSSxLQUFLLEVBQUU7QUFDakMsUUFBUSxDQUFDLEtBQUssR0FBRyxLQUFLO0FBQ3RCLFFBQVEsQ0FBQyxPQUFPLEdBQUcsT0FBTztBQUFBOyJ9","css":""}